# RPA智能脚本生成器 - 使用指南

## 目录
1. [快速开始](#快速开始)
2. [详细功能说明](#详细功能说明)
3. [操作步骤详解](#操作步骤详解)
4. [高级技巧](#高级技巧)
5. [常见问题解答](#常见问题解答)
6. [实战案例](#实战案例)

---

## 快速开始

### 环境准备

1. **前端界面**（无需安装）
   - 只需要现代浏览器（Chrome、Firefox、Safari、Edge）
   - 打开 `index.html` 即可使用

2. **执行生成的脚本**（需要Python环境）
   ```bash
   # 安装Python依赖
   pip install selenium pillow pytesseract
   
   # 安装Chrome浏览器和ChromeDriver
   # macOS
   brew install --cask google-chrome
   brew install chromedriver
   
   # Ubuntu/Debian
   sudo apt-get install chromium-browser chromium-chromedriver
   
   # 安装Tesseract OCR（用于OCR验证）
   # macOS
   brew install tesseract tesseract-lang
   
   # Ubuntu/Debian
   sudo apt-get install tesseract-ocr tesseract-ocr-chi-sim
   ```

### 5分钟快速上手

1. 打开 `index.html`
2. 填写项目名称：`我的第一个自动化脚本`
3. 点击"+ 添加步骤"
4. 配置第一个步骤：
   - 步骤名称：`打开百度首页`
   - 操作类型：`打开网页`
   - 目标URL：`https://www.baidu.com`
5. 点击"保存步骤"
6. 点击"🚀 生成自动化脚本"
7. 查看右侧生成的Python脚本
8. 点击"下载脚本"保存脚本文件

---

## 详细功能说明

### 1. 项目信息管理

**项目名称**
- 为你的自动化项目起一个有意义的名称
- 例如：`自动登录测试`、`数据批量录入`、`每日报表生成`

**项目描述**
- 简要说明自动化流程的目的和功能
- 有助于后期维护和团队协作

### 2. 自动化步骤配置

#### 支持的操作类型

| 操作类型 | 说明 | 参数 | 使用场景 |
|---------|------|------|---------|
| 打开网页 | 导航到指定URL | 目标URL | 打开登录页面、访问特定网站 |
| 点击元素 | 点击页面上的按钮或链接 | 元素选择器 | 点击登录按钮、提交表单 |
| 输入文本 | 在输入框中输入文字 | 元素选择器 + 输入值 | 填写用户名、输入搜索关键词 |
| 选择下拉列表 | 从下拉菜单选择选项 | 元素选择器 + 选项文本 | 选择省份、选择日期 |
| 等待 | 暂停指定秒数 | 等待时间（秒） | 等待页面加载、等待动画完成 |
| 截图 | 保存当前页面截图 | 保存路径 | 记录执行结果、调试脚本 |
| 滚动 | 滚动页面到指定位置 | 滚动距离（像素） | 加载更多内容、查看页面底部 |
| 鼠标悬停 | 鼠标移动到元素上 | 元素选择器 | 显示下拉菜单、查看提示信息 |

#### 元素选择器说明

**ID选择器**（推荐）
```
#login-button
```
- 最快速、最稳定
- 适用于有唯一ID的元素

**Class选择器**
```
.submit-btn
```
- 适用于同类元素
- 会选择第一个匹配的元素

**CSS选择器**
```
input[name="username"]
button.primary.large
div.container > p.text
```
- 功能强大、灵活
- 可以组合多个条件

**XPath选择器**
```
//button[@type="submit"]
//div[@class="form"]//input[@name="email"]
```
- 最灵活、可以向上查找
- 适用于复杂的DOM结构

### 3. 测试数据配置

支持JSON格式的测试数据，可以在步骤中引用：

```json
{
  "username": "test_user",
  "password": "test123",
  "email": "test@example.com",
  "phone": "13800138000",
  "address": "北京市朝阳区"
}
```

**在步骤中引用数据**
```
输入值：{{username}}
输入值：{{password}}
```

### 4. 截图与OCR验证

**上传参考截图**
- 为每个关键步骤上传参考截图
- 截图应该清晰、包含关键信息
- 建议使用PNG或JPG格式

**OCR验证工作原理**
1. 脚本执行时自动截取当前页面
2. 使用Tesseract OCR提取页面文本
3. 与参考截图进行文本相似度对比
4. 计算相似度百分比
5. 生成验证报告

**验证结果解读**
- ✅ 相似度 > 90%：验证通过
- ⚠️ 相似度 80-90%：需要检查
- ❌ 相似度 < 80%：验证失败

---

## 操作步骤详解

### 步骤1：创建新项目

1. 点击右上角"新建项目"按钮（如果需要清空现有内容）
2. 填写项目名称和描述

### 步骤2：添加自动化步骤

1. 点击"+ 添加步骤"按钮
2. 在弹出的对话框中配置步骤信息：
   - **步骤名称**：描述这一步要做什么
   - **操作类型**：从下拉菜单选择
   - **目标元素/URL**：根据操作类型填写
   - **输入值**：如果是输入或选择操作，填写值
   - **参考截图**：上传该步骤的预期截图
   - **备注说明**：可选，添加额外说明
3. 点击"保存步骤"

### 步骤3：编辑和管理步骤

- **编辑步骤**：点击步骤右侧的"编辑"按钮
- **删除步骤**：点击步骤右侧的"删除"按钮
- **调整顺序**：当前版本暂不支持拖拽排序，请删除后重新添加

### 步骤4：配置测试数据

1. 在测试数据区域输入JSON格式的数据
2. 点击"验证数据格式"确保格式正确
3. 在步骤中使用 `{{变量名}}` 引用数据

### 步骤5：生成脚本

1. 确保至少添加了一个步骤
2. 点击"🚀 生成自动化脚本"按钮
3. 等待进度条完成（约2-3秒）
4. 查看右侧生成的Python脚本

### 步骤6：测试脚本（模拟）

1. 点击"▶️ 运行测试"按钮
2. 观察测试日志，查看每步执行情况
3. 检查是否有错误或警告

### 步骤7：OCR验证（模拟）

1. 点击"🔍 OCR验证"按钮
2. 查看OCR验证结果
3. 检查每个步骤的相似度

### 步骤8：导出和使用

1. **复制脚本**：点击"复制脚本"按钮，复制到剪贴板
2. **下载脚本**：点击"下载脚本"按钮，保存为.py文件
3. **导出项目**：点击"导出脚本"按钮，保存项目配置为JSON文件

### 步骤9：运行生成的脚本

```bash
# 确保已安装依赖
pip install selenium pillow pytesseract

# 运行脚本
python3 your_script.py
```

---

## 高级技巧

### 1. 获取元素选择器

**使用Chrome开发者工具**
1. 右键点击目标元素
2. 选择"检查"（Inspect）
3. 在Elements面板中，右键点击HTML元素
4. 选择"Copy" → "Copy selector" 或 "Copy XPath"

**使用Chrome插件**
- ChroPath：自动生成XPath和CSS选择器
- Selector Gadget：可视化选择元素

### 2. 处理动态加载内容

使用"等待"步骤：
```
步骤1：点击"加载更多"按钮
步骤2：等待 3 秒（让内容加载完成）
步骤3：继续后续操作
```

### 3. 处理复杂表单

分步填写，每步添加短暂等待：
```
步骤1：输入用户名
步骤2：等待 0.5 秒
步骤3：输入密码
步骤4：等待 0.5 秒
步骤5：点击登录
```

### 4. 调试技巧

在关键步骤后添加截图：
```
步骤1：点击登录按钮
步骤2：等待 2 秒
步骤3：截图 → login_step1.png
步骤4：输入验证码
步骤5：截图 → login_step2.png
```

### 5. 使用变量引用

在测试数据中定义变量，在多个步骤中复用：
```json
{
  "base_url": "https://example.com",
  "username": "test_user",
  "search_keyword": "Python"
}
```

步骤配置：
```
步骤1：打开网页 → {{base_url}}/login
步骤2：输入文本 → #username → {{username}}
```

---

## 常见问题解答

### Q1: 为什么生成的脚本运行失败？

**A:** 可能的原因：
1. **未安装依赖**：确保安装了 selenium、pillow、pytesseract
2. **ChromeDriver版本不匹配**：确保ChromeDriver与Chrome版本兼容
3. **元素选择器错误**：使用开发者工具验证选择器是否正确
4. **网络问题**：确保可以访问目标网站
5. **页面加载慢**：在关键步骤后添加等待时间

### Q2: 如何获取准确的元素选择器？

**A:** 推荐方法：
1. 使用Chrome开发者工具的"Copy selector"功能
2. 优先使用ID选择器（最稳定）
3. 使用Chrome插件如ChroPath辅助
4. 测试选择器：在Console中运行 `document.querySelector("你的选择器")`

### Q3: OCR验证失败怎么办？

**A:** 检查以下几点：
1. **Tesseract是否正确安装**
2. **参考截图是否清晰**
3. **页面布局是否发生变化**
4. **文本是否为中文**：确保安装了中文语言包
5. **相似度阈值是否合理**：可以适当降低阈值

### Q4: 如何处理需要登录的网站？

**A:** 配置步骤：
```
步骤1：打开登录页面
步骤2：输入用户名 → {{username}}
步骤3：输入密码 → {{password}}
步骤4：点击登录按钮
步骤5：等待 2 秒（等待登录完成）
步骤6：继续后续操作
```

### Q5: 可以处理验证码吗？

**A:** 当前版本不支持自动识别验证码，建议：
1. 使用测试环境（无验证码）
2. 手动输入验证码后继续
3. 使用API绕过验证码

### Q6: 生成的脚本可以修改吗？

**A:** 可以！生成的脚本是标准Python代码，你可以：
1. 添加自定义逻辑
2. 修改等待时间
3. 添加异常处理
4. 集成到现有系统

---

## 实战案例

### 案例1：自动登录并搜索

**需求**：自动登录某网站并搜索关键词

**配置步骤**：
1. 打开网页 → `https://example.com`
2. 点击元素 → `#login-link`（点击登录按钮）
3. 输入文本 → `#username` → `{{username}}`
4. 输入文本 → `#password` → `{{password}}`
5. 点击元素 → `#login-button`
6. 等待 → `3`
7. 输入文本 → `#search-input` → `{{keyword}}`
8. 点击元素 → `#search-button`
9. 等待 → `2`
10. 截图 → `search_result.png`

**测试数据**：
```json
{
  "username": "testuser",
  "password": "testpass123",
  "keyword": "Python教程"
}
```

### 案例2：批量数据录入

**需求**：在表单中批量录入多条数据

**配置步骤**：
1. 打开网页 → `https://example.com/form`
2. 输入文本 → `#name` → `{{name}}`
3. 输入文本 → `#email` → `{{email}}`
4. 输入文本 → `#phone` → `{{phone}}`
5. 选择下拉列表 → `#city` → `{{city}}`
6. 点击元素 → `#submit-button`
7. 等待 → `2`
8. 截图 → `submit_result.png`

**测试数据**：
```json
{
  "name": "张三",
  "email": "zhangsan@example.com",
  "phone": "13800138000",
  "city": "北京"
}
```

### 案例3：网页内容爬取

**需求**：打开网页，滚动加载内容，截图保存

**配置步骤**：
1. 打开网页 → `https://example.com/news`
2. 等待 → `2`
3. 滚动 → `500`（向下滚动500像素）
4. 等待 → `1`
5. 滚动 → `500`
6. 等待 → `1`
7. 截图 → `page_content.png`

---

## 技术支持

如有问题，请查阅：
- 项目README.md
- Selenium官方文档：https://selenium-python.readthedocs.io/
- Tesseract OCR文档：https://github.com/tesseract-ocr/tesseract

---

**祝你使用愉快！🚀**
